/*! weixin-ui 2015-06-12 */
/* author:zhanwangye */
dist/define("zui/form",["zui/form/form","zui/form/field","zui/form/rules"],function(a){var b=$.extend({Form:a("zui/form/form"),Field:a("zui/form/field"),Rules:a("zui/form/rules")});return b}),define("zui/form/form",["zui/base","zui/dialog"],function(a){function b(a){this.el=a.srcNode,this.validType=a.validType?a.validType:"dialog",this.proxy={method:"GET",contentType:"application/x-www-form-urlencoded; charset=utf-8",timeout:2e4,dataType:"json"},this.submitMask=!0,this.validateFunc=a.validateFunc?a.validateFunc:null}function c(a,b){var c=a.getField(b);return $(c).attr("data-rules")?i.looseParse($(c).attr("data-rules")):{}}function d(a,b){var c=a.getField(b);return $(c).attr("data-messages")?i.looseParse($(c).attr("data-messages")):{}}{var e=a("zui/base"),f=a("zui/form/rules"),g=a("zui/form/field"),h=a("zui/dialog").Dialog,i=(e.Utils,e.JSON);e.Array}return b.prototype.showError=function(a,b){var c=this;"dialog"==c.validType&&h.Alert({title:"提示",msg:b,callback:function(){$(a).focus()}}),"flash"==c.validType&&h.Flash({msg:b,duration:2e3})},b.prototype.serializeToObject=function(){return zUtils.serializeToObject(this.el)},b.prototype.serializeToArray=function(){return zUtils.serializeToArray(this.el)},b.prototype.resetForm=function(){zUtils.clear(this.el)},b.prototype.getFields=function(){var a=this,b=a.el;return $(b).find("input,textarea,select")},b.prototype.getField=function(a){{var b,c=this;c.el}return a?(zUtils.each(c.getFields(),function(c){$(c).attr("name")==a&&(b=c)}),b):void 0},b.prototype.getRuleKey=function(a,b,c,d,e){var g=this;if(a[b]&&""!=a[b]){var h=a[b];zUtils.isFunction(g.validateFunc)?g.validateFunc({field:c,validateMsg:h}):g.showError(c,h)}else zUtils.isFunction(g.validateFunc)?g.validateFunc({field:c,validateMsg:f.validField(b,e,d,c,h)}):g.showError(c,f.validField(b,e,d,c,h));return!1},b.prototype.isValid=function(a){var b=this,e=!0,h=c(b,a),i=d(b,a);if(fieldName=b.getField(a),!fieldName)return!0;var j=g.getValue(fieldName);for(var k in h){var l=k,m=h[k];if(!f.isValid(l,j,m,fieldName))return e=b.getRuleKey(i,l,fieldName,m,j);e=!0}return e},b.prototype.valid=function(){var a=this,b=!0,c=a.getFields();return zUtils.each(c,function(c){var d=$(c).attr("name");return a.isValid(d)?void 0:b=!1}),b},b.prototype.ajaxSubmit=function(a){var b,c,d=this,e=d.proxy.method,f=d.url,g=d.submitMask,i=zUtils.serializeToObject(d.el),j=$.extend({url:f,type:e,dataType:"json",data:i},a);a&&a.success&&(b=a.success),a&&a.error&&(c=a.error),j.success=function(a){g&&h.closeDialog(),b&&b(a)},j.error=function(a,b,d){g&&h.closeDialog();var e={exception:{status:b,errorThrown:d,jqXHR:a}};zUtils.isFunction(c)&&c(e)},g&&h.Loading(),$.ajax(j)},b}),define("zui/form/field",["zui/base"],function(a){function b(a){var b=$(a)[0].nodeName;if(void 0!=b)switch(b){case"INPUT":return"input";case"SELECT":return"select";case"TEXTAREA":return"textarea";default:return"input"}}var c=a("zui/base"),d=c.Utils,e={getValue:function(a){if("textarea"==b(a))return $(a).text();var c=$(a).attr("type");return"checkbox"==c||"radio"==c?$(a).prop("checked"):$(a).val()},setValue:function(a,c){if("input"==b(a)){var e=$(a).attr("type");("checkbox"==e||"radio"==e)&&$(a).prop("checked","checked"),$(a).val(c)}if("select"==b(a)){var f=$(a).find("option");d.each(f,function(a){$(a).attr("value")==c&&($(a).siblings().removeAttr("selected"),$(a).attr("selected","selected"))})}"textarea"==b(a)&&$(a).text(c)},setDisabled:function(a,b){1==b?$(a).attr("disabled","disabled"):$(a).removeAttr("disabled")},setReadonly:function(a,b){1==b?$(a).attr("readonly","readonly"):$(a).removeAttr("readonly")}};return e}),define("zui/form/rules",["zui/base"],function(a){function b(a){return parseFloat(a)}function c(a){return k.parse(a)}function d(a){if(null==a)return{};if($.isPlainObject(a))return a;var b=a,c={};if(j.isArray(a)){for(var d=0;d<b.length;d++)c[d]=b[d];return c}return{0:a}}function e(a,b,c){var e=d(b);return c=c||a.msg,j.substitute(c,e)}function f(a,b,c,d,f){j.isArray(c)&&j.isString(c[1])&&(c[1]&&(d=c[1]),c=c[0]);var g=a,h=g.validator,i=e(g,c,d);return b=null==b?"":b,h.call(g,b,c,i,f)}function g(a){var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},c=a.split("");if(!b[parseInt(a.substr(0,2))])return!1;var d;switch(a.length){case 15:var e=parseInt(a.substr(6,2))+1900;return d=h(e)?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,d.test(a);case 18:var e=a.substr(6,4);if(d=h(e)?/^[1-9][0-9]{5}[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}[1-9][0-9]{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,d.test(a)){var f,g,i,j="10X98765432";return g=7*(parseInt(c[0])+parseInt(c[10]))+9*(parseInt(c[1])+parseInt(c[11]))+10*(parseInt(c[2])+parseInt(c[12]))+5*(parseInt(c[3])+parseInt(c[13]))+8*(parseInt(c[4])+parseInt(c[14]))+4*(parseInt(c[5])+parseInt(c[15]))+2*(parseInt(c[6])+parseInt(c[16]))+1*parseInt(c[7])+6*parseInt(c[8])+3*parseInt(c[9]),f=g%11,i=j.substr(f,1),i==c[17]?!0:!1}return!1;default:return!1}}function h(a){var b=parseInt(a);ret=isNaN(b)?!1:b%4==0&&b%100!=0||b%400==0}{var i=a("zui/base"),j=i.Utils,k=i.Date,l={},m={add:function(a,b){return l[a]=b,l[a]},remove:function(a){delete l[a]},get:function(a){return l[a]},validField:function(a,b,c,d){var e=m.get(a);if(e){var g=e.msg;return f(e,b,c,g,d)}return null},isValid:function(a,b,c,d){return null==m.validField(a,b,c,d)}};m.add("required",{name:"required",msg:"不能为空！",validator:function(a,b,c){return b!==!1&&/^\s*$/.test(a)?c:void 0}}),m.add("equalTo",{name:"equalTo",msg:"两次输入不一致！",validator:function(a,b,c){var d=$(b);return d.length&&(b=d.val()),a===b?void 0:c}}),m.add("min",{name:"min",msg:"输入值不能小于{0}！",validator:function(a,c,d){return""!==a&&b(a)<b(c)?d:void 0}}),m.add("max",{name:"max",msg:"输入值不能大于{0}！",validator:function(a,c,d){return""!==a&&b(a)>b(c)?d:void 0}}),m.add("length",{name:"length",msg:"输入值长度为{0}！",validator:function(a,b,c){return null!=a&&(a=$.trim(a.toString()),b!=a.length)?c:void 0}}),m.add("minlength",{name:"minlength",msg:"输入值长度不小于{0}！",validator:function(a,b,c){if(null!=a){a=$.trim(a.toString());var d=a.length;if(b>d)return c}}}),m.add("maxlength",{name:"maxlength",msg:"输入值长度不大于{0}！",validator:function(a,b,c){if(a){a=$.trim(a.toString());var d=a.length;if(d>b)return c}}}),m.add("regexp",{name:"regexp",msg:"输入值不符合{0}！",validator:function(a,b,c){return b?b.test(a)?void 0:c:void 0}}),m.add("email",{name:'"email",',msg:"不是有效的邮箱地址！",validator:function(a,b,c){return a=$.trim(a),a?/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)?void 0:c:void 0}}),m.add("date",{name:"date",msg:"不是有效的日期！",validator:function(a,b,c){return j.isNumber(a)||j.isDate(a)?void 0:(a=$.trim(a),a?j.Date.isDateString(a)?void 0:c:void 0)}}),m.add("minDate",{name:"minDate",msg:"输入日期不能小于{0}！",validator:function(a,b,d){if(a){var e=c(a);if(e&&e<c(b))return d}}}),m.add("maxDate",{name:"maxDate",msg:"输入日期不能大于{0}！",validator:function(a,b,d){if(a){var e=c(a);if(e&&e>c(b))return d}}}),m.add("dateBigerTo",{name:"dateBigerTo",msg:"结束日期不能小于开始日期！",validator:function(a,b,d){var e=$(b);if(e.length)var f=c(e.val());return f&&f>c(a)?d:void 0}}),m.add("mobile",{name:"mobile",msg:"不是有效的手机号码！",validator:function(a,b,c){return a=$.trim(a),a?/^\d{11}$/.test(a)?void 0:c:void 0}}),m.add("number",{name:"number",msg:"不是有效的数字！",validator:function(a,b,c){return j.isNumber(a)?void 0:(a=a.replace(/\,/g,""),isNaN(a)?c:void 0)}}),m.add("url",{name:"url",msg:"不是有效的URL地址！",validator:function(a,b,c){return a=$.trim(a),a?/^http(s?):\/\/[^\r\n]+$/i.test(a)?void 0:c:void 0}}),m.add("isIdCard",{name:"isIdCard",msg:"不是有效的证件号码！",validator:function(a,b,c){return a=$.trim(a),a?g(a)?void 0:c:void 0}})}return m});