/*! weixin-ui 2015-06-02 */
/* author:zhanwangye */
define("zui/list",["zui/list/listselect","zui/list/listrefresh"],function(a){var b=$.extend({ListSelect:a("zui/list/listselect"),ListRefresh:a("zui/list/listrefresh")});return b}),define("zui/list/listselect",["zui/base","zui/mixin"],function(a){function b(a){var b=this;b.options=$.extend(l,a?a:{}),b._init(),$(b.options.render).on("click",function(){b.open()}),$(window).on("onorientationchange"in window?"orientationchange":"resize",function(){c(b)})}function c(a){if("bottom"==a.options.position){var b="position:absolute;bottom:0;width:100%;height:"+a.options.height+"px;";a.el.attr("style",b)}if("top"==a.options.position){var b="position:absolute;top:0;width:100%;height:"+a.options.height+"px;";a.el.attr("style",b)}if("center"==a.options.position){var c=f.viewportHeight(),d=a.options.height?a.options.height:c-100,e=f.viewportWidth(),g=a.options.width?a.options.width:e-30,h="-"+parseInt(g/2)+"px;",i="-"+parseInt(d/2)+"px;",b="position:absolute;top:50%;left:50%;margin-top:"+i+"margin-left:"+h;a.el.attr("style",b),a.el.css({height:d,width:g})}}var d=a("zui/base"),e=a("zui/mixin"),f=d.Utils,g=d.Array,h=e.iScroll,i=e.Touch,j='<div id="zSelect" class="z-ui-select hidden"><div id="scroller"></div></div>',k='<style id="selectCls"></style>',l={render:"",data:[],scrollbar:!0,mask:!0,position:"bottom",width:null,height:null,sortField:null,eventType:"click",selected:function(){},activeCls:"active",tpl:'<ul class="list-group"></ul>',itemTpl:'<li data-index={index} class="list-group-item">{name}</li>'};return b.prototype._init=function(){var a=this;$("body").append(j),$("head").append(k),a.el=$(".z-ui-select"),c(a);var b=$("#scroller",a.el);b.append(a.options.tpl),a.dataContainer=b.children();var d=a.options.data,e="";f.each(d,function(b,c){b.index=c,0!=b.isEnable&&(e+=f.substitute(a.options.itemTpl,b))}),a.dataContainer.html(e);var g=a.dataContainer.children();f.each(g,function(b){a.eventHandler(b)}),a.options.scrollbar&&(a.iscroll=new h("#"+a.el.attr("id"),{mouseWheel:!0,click:!0}))},b.prototype.eventHandler=function(a){var b=this;$(a).on(b.options.eventType,function(a){var c=b.options.data[$(this).data("index")];$(this).siblings().removeClass(b.options.activeCls),$(this).addClass(b.options.activeCls);var d=a.target;b.close(),b.options.selected({item:c,domTarget:d})})},b.prototype._destory=function(){$(".z-ui-select").remove(),$("#selectCls").remove()},b.prototype.setItemEnable=function(a,b,c){var d=this,e=d.dataContainer.children();f.each(e,function(e,f){$(e).data("item")[a]==b&&(d.options.data[f].isEnable=c?!0:!1)}),d.refresh()},b.prototype.delItems=function(a,b){var c=this,d=c.dataContainer.children();f.each(d,function(d,e){$(d).data("item")[a]==b&&(c.options.data=g.removeAt(c.options.data,e))}),c.refresh()},b.prototype.sortItems=function(){},b.prototype.refresh=function(){this._destory(),this._init()},b.prototype.open=function(){this.el.removeClass("hidden"),this.options.mask&&(this.maskbar=new zMask,this.maskbar.show("body",null,!1)),this.iscroll.refresh(),i.enableTouchMove(document,!1)},b.prototype.close=function(){this.el.addClass("hidden"),this.maskbar.close(),i.enableTouchMove(document,!0)},b}),define("zui/listrefresh",["zui/base"],function(a){"use strict";function b(a){var b={srcNode:document,scrollContainer:document,proxy:{dataType:"json",method:"get"},params:{},itemTpl:"<li></li>",downTpl:"",upTpl:"",upRefresh:!0,downRefresh:!1};this.resultData=[],this.options=$.extend(b,a||{}),this.init(),this.handleEvent()}var c=a("zui/base"),d=c.Utils;return b.prototype={init:function(){this.el=$(this.options.srcNode),this.el&&this.loadData()},loadData:function(){var a=this;$.ajax({async:!1,type:a.options.proxy.method,data:a.params,dataType:a.options.proxy.dataType,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){a.resultData.push(b[a.params.rows]),a.render(b[a.params.rows])}})},render:function(a){for(var b="",c=0;c<a.length;c++)b+=d.substitute(this.options.itemTpl,a[c]);this.el.append(b)},loadNextPage:function(){this.params.start=this.params.start+this.params.limit,this.loadData()},handleEvent:function(){var a=this;$(a.scrollContainer).on("scroll",function(){a.upRefresh&&$(a.el.height()-$(a.scrollContainer).scrollTop())<=$(a.scrollContainer)[0].clientHeight&&a.loadNextPage(),a.downRefresh&&$(a.scrollContainer).scrollTop()<=0&&a.reload()})},reload:function(){this.resultData=[],this.params.start=0,this.init()}},b});