/*! weixin-ui 2015-06-12 */
/* author:zhanwangye */
dist/define("zui/upload",["zui/upload/uploadImage"],function(a){var b=$.extend({UploadImage:a("zui/upload/uploadImage")});return b}),define("zui/uploadimage",["zui/base","zui/dialog","zui/form"],function(a){function b(a){var a=a||{},b=this;b.fileInput=document.getElementById(a.file),b.progress=document.getElementById(a.progress),b.uploadForm=document.getElementById(a.uploadForm),window.FileReader?(b.holder=document.getElementById(a.holder),b.imageShow=a.imageshow,b.loaded=0,b.step=1048576,b.times=0,b.fileInput.onchange=function(){return b.file=this.files,/image\/\w+/.test(this.files[0].type)?(a.autoLoad&&b.uploadFile(a),void(a.readImage&&b.readFile())):(b.fileInput.value="",d.Alert({msg:"请确保文件为图像类型"}),!1)}):alert("Not supported by your browser!")}{var c=a("zui/base"),d=(a("zui/form"),a("zui/dialog").Dialog),e=c.Utils;c.Array}return b.prototype={uploadFile:function(a){var b=this,c=new XMLHttpRequest;c.open("post",a.url),c.timeout=2e4,c.overrideMimeType("text/plain; charset=utf-8"),a.responseType&&(c.responseType=a.responseType),c.ontimeout=function(){d.Alert({msg:"请求超时！"})},c.onreadystatechange=function(){if(4==c.readyState)switch(d.closeDialog(),c.status){case 200:e.isFunction(a.callback)&&a.callback(c)}},c.onprogress=function(a){if(a.lengthComputable){a.loaded/a.total}},c.oncomplete=function(){d.closeDialog()};var f=new FormData(b.uploadForm);d.Loading({msg:"<p style='margin-top:5px;'>上传中</p>"}),c.send(f)},writeFile:function(){var a=new FileReader;return a.readAsBinaryString(this.file)},getFiles:function(){return this.file},readFile:function(){var a=this,b=a.file[0],c=a.reader=new FileReader;c.readAsDataURL(b),a.total=b.size,c.onloadstart=function(){a.onLoadStart()},a.progress&&(c.onprogress=function(b){a.onProgress(b)}),c.onabort=function(b){a.onAbort(b)},c.onerror=function(b){a.onerror(b)},c.onload=function(b){a.onLoad(b)},c.onloadend=function(b){a.onLoadEnd(b)},a.readBlob(b,0)},onLoadStart:function(){},onProgress:function(a){var b=this;b.loaded=a.loaded,a.lengthComputable&&(b.progress.value=b.loaded/b.total*100)},onAbort:function(){},onError:function(){},onLoad:function(a){var b=this;b.holder&&(a.loaded<b.total?b.readBlob(a.loaded):(b.loaded=b.total,b.holder.innerHTML='<img style="height:auto;width:100%;display:block;" src="'+b.reader.result+'" alt=""/>'))},onLoadEnd:function(){},readBlob:function(a){var b,c=this,e=c.file[0];c.times+=1,e.slice?b=e.slice(a,a+c.step+1):e.webkitSlice?b=e.webkitSlice(a,a+c.step+1):e.mozSlice?b=e.mozSlice(a,a+c.step+1):d.Alert({msg:"浏览器不支持分段读取文件!"})},abortHandler:function(){var a=this;a.reader&&a.reader.abort()}},b});